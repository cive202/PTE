I will implement the **Refined Production-Ready Plan** incorporating all your critical guardrails and architectural improvements.

### **Phase 1: Dependencies & Environment**

1. **Install Required Libraries**:

   * `g2p_en`, `jiwer`, `cmudict`, `librosa`, `soundfile`.

   * (Confirming `transformers` and `torchaudio` presence).

### **Phase 2: Core Logic Modules**

1. **Create** **`pte_core/phoneme/g2p.py`**:

   * Implement `PhonemeReferenceBuilder`.

   * **Guardrail**: Add `["AH"]` fallback for empty phoneme returns (numbers/symbols) to prevent PER crash.
2. **Create** **`pte_core/asr/phoneme_recognition.py`**:

   * Implement `PhonemeASR` using `facebook/wav2vec2-lv-60-espeak-cv-ft`.

   * **Optimization**: Load model **once globally** at startup.

   * **Safety**: Wrap inference in `torch.no_grad()`.
3. **Create** **`pte_core/scoring/pronunciation.py`**:

   * Implement `PhonemeErrorRate` (PER) scoring.

   * **Guardrail**: Clamp scores `max(0, min(score, 1))` to handle edge cases.

### **Phase 3: Validator Refactoring (`api/validator.py`)**

1. **Integration Logic**:

   * **Stage 1**: Keep Parakeet ASR for timestamps/content.

   * **Stage 4 (Slicing)**: Slice audio using `librosa`/`soundfile` based on ASR timestamps.

     * **Guardrail**: Skip phoneme ASR if segment duration `< 0.08s`.

   * **Stage 5 (Scoring)**: Compare Reference vs. Observed Phonemes using PER.

     * **Thresholds**: PER ≤ 0.15 (Correct), 0.15–0.35 (Acceptable), >0.35 (Mispronounced).

   * **Stage 6 (MFA)**: Downgrade MFA to **Timing Provider Only**.

     * **Fallback**: If MFA fails, do NOT fail the word; just skip timing enrichment.

   * **Stage 7 (Pause)**: Update thresholds and add **Micro-pause filter** (ignore < 0.12s).

   * **Stage 10 (Weights)**: Content 40%, Pronunciation 40%, Fluency 20%.

### **Phase 4: Verification**

1. **Restart & Test**:

   * Validate against Test Cases: Perfect Read, Mispronounced Vowels, Missing Word, Monotone Read.

   * Ensure Windows/Docker file handling uses absolute paths and closes file handles.

